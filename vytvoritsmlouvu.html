<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vytvo≈ôit smlouvu ‚Äì Altiven 2.0</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b5fff">

  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="main-header app-only">
    <div class="logo"><span class="logo-sm">üìÑ</span><h1>Vytvo≈ôit smlouvu</h1></div>
    <nav class="top-actions">
      <a class="btn ghost" href="index.html">‚Üê Zpƒõt</a>
      <button class="btn" onclick="location.href='predavaciprotokol.html'">P≈ôej√≠t na p≈ôed√°vac√≠ protokol ‚Üí</button>
    </nav>
  </header>

  <main class="container contract-wide">
    <!-- ==== TV≈ÆJ P≈ÆVODN√ç OBSAH ‚Äì BEZE ZMƒöN ==== -->
    <section class="card">
      <h2>√ödaje smluvn√≠ch stran</h2>
      <div class="form-row">
        <div>
          <label>Zhotovitel ‚Äì firma</label>
          <input class="input" id="z_firma" placeholder="Altiven, s.r.o.">
        </div>
        <div>
          <label>IƒåO</label>
          <input class="input" id="z_ico" placeholder="12345678">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>DIƒå</label>
          <input class="input" id="z_dic" placeholder="CZ12345678">
        </div>
        <div>
          <label>S√≠dlo / adresa</label>
          <input class="input" id="z_sidlo" placeholder="Ulice, Mƒõsto">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Kontakt</label>
          <input class="input" id="z_kontakt" placeholder="telefon, e‚Äëmail">
        </div>
        <div>
          <label>Objednatel ‚Äì jm√©no/firma</label>
          <input class="input" id="o_jmeno" placeholder="Jan Nov√°k / Firma s.r.o.">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Objednatel ‚Äì IƒåO</label>
          <input class="input" id="o_ico" placeholder="87654321">
        </div>
        <div>
          <label>Objednatel ‚Äì DIƒå</label>
          <input class="input" id="o_dic" placeholder="CZ87654321">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Objednatel ‚Äì s√≠dlo/adresa</label>
          <input class="input" id="o_sidlo" placeholder="Ulice, Mƒõsto">
        </div>
        <div>
          <label>Objednatel ‚Äì kontakt</label>
          <input class="input" id="o_kontakt" placeholder="telefon, e‚Äëmail">
        </div>
      </div>
    </section>

    <section class="card mt16">
      <h2>P≈ôedmƒõt, cena, term√≠ny</h2>
      <div class="form-row">
        <div>
          <label>Popis prac√≠</label>
          <input class="input" id="popis_praci" placeholder="Nap≈ô. rekonstrukce koupelny‚Ä¶">
        </div>
        <div>
          <label>M√≠sto plnƒõn√≠</label>
          <input class="input" id="misto" placeholder="Adresa">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Cena celkem (s DPH)</label>
          <input class="input" id="cena_celkem" placeholder="nap≈ô. 150 000 Kƒç">
        </div>
        <div>
          <label>Z√°ruka (mƒõs√≠ce)</label>
          <input class="input" id="zaruka" type="number" min="0" step="1" value="24">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Z√°loha (ƒç√°stka)</label>
          <input class="input" id="zaloha" placeholder="nap≈ô. 30 000 Kƒç">
        </div>
        <div>
          <label>Z√°loha splatn√° do (datum)</label>
          <input class="input" id="zaloha_do" type="date">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Doplatek splatn√Ω do (datum)</label>
          <input class="input" id="doplatek_do" type="date">
        </div>
        <div>
          <label>√öƒçet / VS</label>
          <input class="input" id="ucet" placeholder="CZ..., banka">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Variabiln√≠ symbol</label>
          <input class="input" id="vs" placeholder="nap≈ô. 20250001">
        </div>
        <div>
          <label>P≈ôed√°n√≠ (datum)</label>
          <input class="input" id="term_predani" type="date">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Zah√°jen√≠</label>
          <input class="input" id="term_zacatek" type="date">
        </div>
        <div>
          <label>Dokonƒçen√≠</label>
          <input class="input" id="term_konec" type="date">
        </div>
      </div>
    </section>

    <section class="card mt16">
      <h2>Voliteln√© klauzule</h2>
      <div class="small">Za≈°krtni, co chce≈° zahrnout. M≈Ø≈æe≈° je v≈°echno <strong>zapnout jedn√≠m klikem</strong>.</div>
      <div class="flex mt12 app-only">
        <label class="flex" style="gap:8px">
          <input type="checkbox" id="check_all">
          <span>Za≈°krtnout v≈°echny</span>
        </label>
        <div class="right small">Tyto p≈ôep√≠naƒçe se v exportu neuk√°≈æou.</div>
      </div>

      <div id="clauses" class="mt12"></div>

      <div class="form-row mt12">
        <div>
          <label>Kdo hrad√≠ odpad</label>
          <select class="input" id="odpad_plati">
            <option value="zhotovitel">Zhotovitel</option>
            <option value="objednatel">Objednatel</option>
          </select>
        </div>
        <div>
          <label>Pokuta objednatele za prodlen√≠ (ƒç√°stka/den)</label>
          <input class="input" id="pokuta_obj" placeholder="nap≈ô. 500 Kƒç">
        </div>
      </div>
      <div class="form-row mt12">
        <div>
          <label>Pokuta za neopr√°vnƒõn√© odstoupen√≠</label>
          <input class="input" id="pokuta_odstoupeni" placeholder="nap≈ô. 15 % z ceny d√≠la">
        </div>
        <div>
          <label>Poƒçet vyhotoven√≠ smlouvy</label>
          <input class="input" id="pocet_vyhotoveni" type="number" min="1" value="2">
        </div>
      </div>
    </section>

    <div class="flex app-only mt16">
      <button class="btn ok" id="showFinal">Zobrazit fin√°ln√≠ smlouvu</button>
      <div class="right small">Fin√°ln√≠ v√Ωstup je na samostatn√© str√°nce bez tlaƒç√≠tek.</div>
    </div>
  </main>

  <footer class="app-footer app-only"><p>¬© 2025 Altiven</p></footer>

  <!-- Hlavn√≠ logika aplikace (definuje loadContractData/saveContractData atd.) -->
  <script src="js/script.js"></script>

  <!-- Firebase SDK (compat) ‚Äì po≈ôad√≠ d≈Øle≈æit√© -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Sync vrstva -->
  <script src="js/firebase.js"></script>
  <script>
    FirebaseSync.init({
      apiKey: "TV≈ÆJ_API_KEY",
      authDomain: "TV≈ÆJ-PROJEKT.firebaseapp.com",
      projectId: "TV≈ÆJ-PROJEKT",
      storageBucket: "TV≈ÆJ-PROJEKT.appspot.com",
      messagingSenderId: "XXXXXXXX",
      appId: "1:XXXXXXXX:web:YYYYYYYY"
    });
  </script>

  <!-- Registrace service workeru (PWA / offline) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }
  </script>

  <!-- Logika t√©to str√°nky (p≈Øvodn√≠) -->
  <script>
  // 1) Kompletn√≠ seznam klauzul√≠ (m≈Ø≈æe≈° libovolnƒõ roz≈°√≠≈ôit)
  const CLAUSE_TEXTS = [
    "Objednatel zajist√≠ po celou dobu realizace p≈ô√≠stup k vodƒõ, elekt≈ôinƒõ a hygienick√©mu z√°zem√≠.",
    "Objednatel p≈ôed√° staveni≈°tƒõ bez p≈ôek√°≈æek; zji≈°tƒõn√© p≈ôek√°≈æky prodlu≈æuj√≠ lh≈Øty o dobu jejich trv√°n√≠.",
    "Zhotovitel je opr√°vnƒõn p≈ôeru≈°it pr√°ce p≈ôi neuhrazen√≠ z√°lohy nebo p≈ôi hrub√©m poru≈°en√≠ povinnost√≠ objednatele.",
    "V√≠cen√°klady vznikl√© zmƒõnami zad√°n√≠ budou provedeny pouze na z√°kladƒõ p√≠semn√©ho souhlasu objednatele.",
    "Zhotovitel odpov√≠d√° za kvalitu d√≠la dle p≈ô√≠slu≈°n√Ωch norem; bƒõ≈æn√© odchylky dle ƒåSN nejsou vadou.",
    "Z√°ruka se nevztahuje na vady zp≈Øsoben√© nevhodn√Ωm u≈æ√≠v√°n√≠m, nedostateƒçnou √∫dr≈æbou, nebo z√°sahy t≈ôet√≠ch osob.",
    "Objednatel je povinen zajistit ochranu ji≈æ proveden√Ωch ƒç√°st√≠ d√≠la p≈ôed po≈°kozen√≠m t≈ôet√≠mi osobami.",
    "Objednatel umo≈æn√≠ zhotoviteli prov√©st pot≈ôebn√© zkou≈°ky a kontroly bez zbyteƒçn√Ωch pr≈Øtah≈Ø.",
    "Smluvn√≠ pokuta za neopr√°vnƒõn√© odstoupen√≠ objednatele slou≈æ√≠ jako pau≈°alizovan√° n√°hrada ≈°kody a u≈°l√©ho zisku.",
    "Drobn√© v√≠cepr√°ce do 5 % ceny d√≠la lze fakturovat bez dodatku, pokud byly prokazatelnƒõ provedeny a odsouhlaseny.",
    "P≈ôed√°n√≠ d√≠la probƒõhne protokol√°rnƒõ; zjevn√© vady mus√≠ b√Ωt uplatnƒõny p≈ôi p≈ôed√°n√≠, skryt√© bez zbyteƒçn√©ho odkladu po zji≈°tƒõn√≠.",
    "Objednatel umo≈æn√≠ bezpeƒçn√Ω p≈ô√≠stup na stavbu; poru≈°en√≠ povinnost√≠ BOZP je d≈Øvodem k p≈ôeru≈°en√≠ prac√≠.",
    "Zhotovitel poskytuje z√°ruku na proveden√© pr√°ce po dobu 24 mƒõs√≠c≈Ø od p≈ôed√°n√≠.",
    "Ve≈°ker√© v√≠cepr√°ce, zmƒõny nebo dopl≈àuj√≠c√≠ plnƒõn√≠ mus√≠ b√Ωt odsouhlaseny p√≠semnƒõ formou dodatku.",
    "V p≈ô√≠padƒõ prodlen√≠ s dokonƒçen√≠m d√≠la hrad√≠ zhotovitel smluvn√≠ pokutu 0,1 % z ceny d√≠la za ka≈æd√Ω den, max. 5 %.",
    "Objednatel si vyhrazuje zadr≈æet 5 % z ceny d√≠la jako jistotu na vady; 1/2 po p≈ôed√°n√≠, 1/2 po z√°ruce.",
    "Zhotovitel neodpov√≠d√° za prodlen√≠ z d≈Øvodu vy≈°≈°√≠ moci (≈æivel, st√°vka apod.); je povinen o tom informovat.",
    "Zhotovitel m≈Ø≈æe vyu≈æ√≠t subdodavatele a odpov√≠d√° za jejich pr√°ci v pln√©m rozsahu.",
    "Smlouva m≈Ø≈æe b√Ωt vypovƒõzena kteroukoli stranou bez d≈Øvodu s v√Ωpovƒõdn√≠ lh≈Øtou 14 dn√≠; hrad√≠ se prokazatelnƒõ proveden√© pr√°ce.",
    "Spory budou ≈ôe≈°eny rozhodƒç√≠m ≈ô√≠zen√≠m p≈ôi HK ƒåR; rozhodnut√≠ je z√°vazn√©.",
    "Je‚Äëli nƒõkter√© ustanoven√≠ neplatn√©, ostatn√≠ z≈Øst√°vaj√≠ v platnosti (salv√°torsk√° dolo≈æka).",
    "Objednatel m√° pr√°vo pr≈Øbƒõ≈ænƒõ kontrolovat kvalitu prac√≠ a vy≈æ√°dat si doklady (certifik√°ty, protokoly)."
  ];

  // 2) Bezpeƒçn√© naƒçten√≠/ulo≈æen√≠ (funguje i kdy≈æ core funkce nejsou k dispozici)
  function safeLoadContractData(){
    try {
      if (typeof loadContractData === 'function') return loadContractData() || {};
    } catch(e){}
    try { return JSON.parse(localStorage.getItem('contract_current') || '{}'); } catch(e){ return {}; }
  }
  function safeSaveContractData(data){
    try {
      if (typeof saveContractData === 'function') return saveContractData(data);
    } catch(e){}
    localStorage.setItem('contract_current', JSON.stringify(data));
  }

  const CONTRACT_INPUT_IDS = [
    'z_firma','z_ico','z_dic','z_sidlo','z_kontakt',
    'o_jmeno','o_ico','o_dic','o_sidlo','o_kontakt',
    'popis_praci','misto','cena_celkem','zaloha','zaloha_do',
    'doplatek_do','ucet','vs','term_predani','term_zacatek','term_konec',
    'zaruka','pokuta_obj','pokuta_odstoupeni','pocet_vyhotoveni','odpad_plati'
  ];

  function renderClauses(){
    const d = safeLoadContractData() || {};
    const selected = new Set(Array.isArray(d.clauses) ? d.clauses : []);
    const wrap = document.getElementById('clauses');
    if (!wrap) return;

    wrap.innerHTML = '';
    CLAUSE_TEXTS.forEach((t, i) => {
      const id = 'cl_' + i;
      const isChecked = selected.size ? selected.has(t) : true; // kdy≈æ nic ulo≈æen√© ‚Üí za≈°krtnout v≈°e
      const row = document.createElement('div');
      row.className = 'flex';
      row.innerHTML =
        `<label class="flex" style="gap:8px">
           <input type="checkbox" id="${id}" ${isChecked ? 'checked' : ''}>
           <span>${t}</span>
         </label>`;
      wrap.appendChild(row);
    });
  }

  function fillInputsFromData(){
    const d = safeLoadContractData() || {};
    CONTRACT_INPUT_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el && d[id] != null) el.value = d[id];
    });
  }

  function collectContractForm(){
    const obj = {};
    CONTRACT_INPUT_IDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) obj[id] = el.value;
    });
    obj.clauses = Array.from(
      document.querySelectorAll('#clauses input[type=checkbox]:checked')
    ).map(ch => ch.nextElementSibling.textContent);
    return obj;
  }

  function autosave(){
    safeSaveContractData(collectContractForm());
  }

  document.addEventListener('DOMContentLoaded', () => {
    renderClauses();
    fillInputsFromData();

    const checkAll = document.getElementById('check_all');
    if (checkAll) {
      checkAll.addEventListener('change', e => {
        const v = e.target.checked;
        document.querySelectorAll('#clauses input[type=checkbox]').forEach(ch => ch.checked = v);
        autosave();
      });
    }

    document.querySelectorAll('input,select,textarea').forEach(el => {
      el.addEventListener('input', autosave);
      el.addEventListener('change', autosave);
    });

    const btn = document.getElementById('showFinal');
    if (btn) btn.addEventListener('click', () => {
      autosave();
      window.location.href = 'vytvorenakarta.html';
    });
  });
</script>
