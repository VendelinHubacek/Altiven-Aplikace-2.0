<!DOC<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cen√≠k prac√≠ ‚Äì Altiven 2.0</title>
  <link rel="stylesheet" href="css/style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    .grid-tiles { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:12px; margin-top:16px; }
    .tile { display:block; border:1px solid #ddd; border-radius:10px; padding:14px; text-decoration:none; color:inherit; background:#fff; }
    .tile-ico { font-size:24px; }
    .tile-title { font-weight:700; margin-top:6px; }
    .tile-desc { font-size:14px; color:#666; margin-top:4px; }
    .price-input,.qty-input { width:110px; }
    .readonly { background:#f3f3f3; pointer-events:none; }
    .table-wrap { overflow:auto; margin-top:12px; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:8px; border:1px solid #ddd; }
    th { background:#f7f7f7; }
    .right { text-align:right; }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; background:#eee; font-size:12px; font-weight:600; }
    .badge.success { background:#d7f5e3; color:#0a7f38; }
  </style>
</head>
<body>
  <header class="main-header app-only">
    <div class="logo"><span class="logo-sm">üìã</span><h1 id="pageTitle">Cen√≠k prac√≠</h1></div>
    <nav class="top-actions">
      <a class="btn ghost" href="index.html">‚Üê Zpƒõt</a>
      <button class="btn" onclick="location.href='novanabidka.html'">Pokraƒçovat na nab√≠dku ‚Üí</button>
    </nav>
  </header>

  <main class="container">
    <!-- 1) M≈ò√ç≈ΩKA PROFES√ç (kdy≈æ nen√≠ ?p=) -->
    <section id="profeseGrid" class="grid-tiles" style="display:none"></section>

    <!-- 2) DETAIL CEN√çKU (kdy≈æ je ?p=) -->
    <section id="cenikCard" class="card" style="display:none">
      <div class="flex" style="justify-content:space-between;align-items:center;">
        <h2 id="hlavicka">Polo≈æky a v√Ωpoƒçet</h2>
        <span id="premiumBadge" class="badge">FREE</span>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
          <tr>
            <th style="min-width:260px;">Pr√°ce</th>
            <th style="min-width:140px;">Cena (Kƒç/jedn.)</th>
            <th style="min-width:140px;">Mno≈æstv√≠</th>
            <th style="min-width:120px;">Jednotka</th>
            <th style="min-width:140px;">Celkem (Kƒç)</th>
          </tr>
          </thead>
          <tbody id="rows"></tbody>
          <tfoot>
          <tr>
            <td colspan="4" class="right"><strong>Mezisouƒçet</strong></td>
            <td><strong id="sum">0.00</strong></td>
          </tr>
          </tfoot>
        </table>
      </div>

      <div class="flex app-only" style="margin-top:12px; gap:8px;">
        <button id="savePrices" class="btn" style="display:none">üíæ Ulo≈æit ceny (PREMIUM)</button>
        <button id="sendToOffer" class="btn ok">‚ûï P≈ôen√©st vybran√© polo≈æky do nab√≠dky</button>
      </div>
    </section>
  </main>

  <footer class="app-footer app-only"><p>¬© 2025 Altiven</p></footer>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ---- 1) Definice profes√≠ a polo≈æek (kl√≠ƒçe = ?p=) ----
    const LABELS = {
      obkladaci:"Obkladaƒçi", zednici:"Zedn√≠ci", maliri:"Mal√≠≈ôi a natƒõraƒçi",
      elektrikari:"Elektrik√°≈ôi", instalateri:"Instalat√©≈ôi", tesari:"Tesa≈ôi",
      pokryvaci:"Pokr√Ωvaƒçi", klempiri:"Klemp√≠≈ôi", sadrokartonari:"S√°drokarton√°≈ôi",
      podlahari:"Podlah√°≈ôi", truhlari:"Truhl√°≈ôi", sklenari:"Sklen√°≈ôi",
      kamenici:"Kamen√≠ci", zamecnici:"Z√°meƒçn√≠ci", svareci:"Sv√°≈ôeƒçi",
      automechanici:"Automechanici", autoklempiri:"Autoklemp√≠≈ôi", autolakyrnici:"Autolak√Ωrn√≠ci",
      zahradnici:"Zahradn√≠ci", kovari:"Kov√°≈ôi", montaznici:"Mont√°≈æn√≠ci n√°bytku",
      uklid:"√öklidov√© slu≈æby", ostatni:"Ostatn√≠ pr√°ce"
    };

    const ITEMS = {
      obkladaci: [
        { name:"Pokl√°dka obklad≈Ø ‚Äì standard", unitPrice:500, unit:"m¬≤", qtyDefault:0 },
        { name:"Pokl√°dka obklad≈Ø ‚Äì slo≈æit√°", unitPrice:700, unit:"m¬≤", qtyDefault:0 },
        { name:"Sp√°rov√°n√≠ a ƒçi≈°tƒõn√≠", unitPrice:120, unit:"m¬≤", qtyDefault:0 }
      ],
      zednici: [
        { name:"Zdƒõn√≠ p≈ô√≠ƒçek", unitPrice:450, unit:"m¬≤", qtyDefault:0 },
        { name:"Om√≠tky ruƒçn√≠", unitPrice:180, unit:"m¬≤", qtyDefault:0 },
        { name:"Bourac√≠ pr√°ce", unitPrice:350, unit:"hod", qtyDefault:0 }
      ],
      maliri: [
        { name:"Malba b√≠l√°", unitPrice:65, unit:"m¬≤", qtyDefault:0 },
        { name:"Malba t√≥novan√°", unitPrice:90, unit:"m¬≤", qtyDefault:0 },
        { name:"≈†tukov√°n√≠", unitPrice:140, unit:"m¬≤", qtyDefault:0 }
      ],
      elektrikari: [
        { name:"Nov√© rozvody ‚Äì pr√°ce", unitPrice:450, unit:"hod", qtyDefault:0 },
        { name:"Mont√°≈æ z√°suvky/vyp√≠naƒçe", unitPrice:250, unit:"ks", qtyDefault:0 },
        { name:"Mont√°≈æ svƒõtla", unitPrice:350, unit:"ks", qtyDefault:0 }
      ],
      instalateri: [
        { name:"Rozvody vody/odpadu ‚Äì pr√°ce", unitPrice:420, unit:"hod", qtyDefault:0 },
        { name:"Mont√°≈æ baterie/sanit.", unitPrice:350, unit:"ks", qtyDefault:0 },
        { name:"Tlakov√° zkou≈°ka", unitPrice:600, unit:"zak√°zka", qtyDefault:0 }
      ],
      tesari: [
        { name:"Krov/konstrukce ‚Äì pr√°ce", unitPrice:480, unit:"hod", qtyDefault:0 },
        { name:"Mont√°≈æ lat√≠", unitPrice:60, unit:"m¬≤", qtyDefault:0 },
        { name:"Opravy konstrukc√≠", unitPrice:520, unit:"hod", qtyDefault:0 }
      ],
      pokryvaci: [
        { name:"Pokl√°dka krytiny", unitPrice:220, unit:"m¬≤", qtyDefault:0 },
        { name:"Mont√°≈æ dopl≈àk≈Ø", unitPrice:350, unit:"ks", qtyDefault:0 },
        { name:"Demont√°≈æ star√© krytiny", unitPrice:140, unit:"m¬≤", qtyDefault:0 }
      ],
      klempiri: [
        { name:"Okapy a svody ‚Äì mont√°≈æ", unitPrice:220, unit:"m", qtyDefault:0 },
        { name:"Lemov√°n√≠", unitPrice:260, unit:"m", qtyDefault:0 },
        { name:"Parapety ‚Äì mont√°≈æ", unitPrice:300, unit:"ks", qtyDefault:0 }
      ],
      sadrokartonari: [
        { name:"SDK p≈ô√≠ƒçky", unitPrice:380, unit:"m¬≤", qtyDefault:0 },
        { name:"SDK podhledy", unitPrice:360, unit:"m¬≤", qtyDefault:0 },
        { name:"Tmelen√≠ a brou≈°en√≠", unitPrice:90, unit:"m¬≤", qtyDefault:0 }
      ],
      podlahari: [
        { name:"Pokl√°dka vinyl/lamino", unitPrice:180, unit:"m¬≤", qtyDefault:0 },
        { name:"Li≈°tov√°n√≠", unitPrice:60, unit:"m", qtyDefault:0 },
        { name:"Samonivelaƒçn√≠ stƒõrka", unitPrice:120, unit:"m¬≤", qtyDefault:0 }
      ],
      truhlari: [
        { name:"Mont√°≈æ n√°bytku", unitPrice:450, unit:"hod", qtyDefault:0 },
        { name:"Drobn√© √∫pravy", unitPrice:350, unit:"hod", qtyDefault:0 },
        { name:"Osazen√≠ dve≈ô√≠", unitPrice:600, unit:"ks", qtyDefault:0 }
      ],
      sklenari: [
        { name:"V√Ω≈ôez a osazen√≠ skla", unitPrice:450, unit:"hod", qtyDefault:0 },
        { name:"Tmelov√°n√≠", unitPrice:220, unit:"hod", qtyDefault:0 },
        { name:"V√Ωmƒõna okenn√≠ tabule", unitPrice:550, unit:"ks", qtyDefault:0 }
      ],
      kamenici: [
        { name:"Osazen√≠ kamene", unitPrice:700, unit:"m¬≤", qtyDefault:0 },
        { name:"≈òez√°n√≠ a brou≈°en√≠", unitPrice:600, unit:"hod", qtyDefault:0 },
        { name:"Sp√°rov√°n√≠ obkladu", unitPrice:150, unit:"m¬≤", qtyDefault:0 }
      ],
      zamecnici: [
        { name:"Mont√°≈æ kovov√Ωch prvk≈Ø", unitPrice:500, unit:"hod", qtyDefault:0 },
        { name:"D√≠lensk√© pr√°ce", unitPrice:450, unit:"hod", qtyDefault:0 },
        { name:"Mont√°≈æ z√°bradl√≠", unitPrice:800, unit:"bm", qtyDefault:0 }
      ],
      svareci: [
        { name:"Sv√°≈ôen√≠ MIG", unitPrice:600, unit:"hod", qtyDefault:0 },
        { name:"Sv√°≈ôen√≠ TIG", unitPrice:650, unit:"hod", qtyDefault:0 },
        { name:"P≈ô√≠prava materi√°lu", unitPrice:400, unit:"hod", qtyDefault:0 }
      ],
      automechanici: [
        { name:"Mechanick√© pr√°ce", unitPrice:700, unit:"hod", qtyDefault:0 },
        { name:"Diagnostika", unitPrice:900, unit:"zak√°zka", qtyDefault:0 },
        { name:"V√Ωmƒõna brzd", unitPrice:1200, unit:"n√°prava", qtyDefault:0 }
      ],
      autoklempiri: [
        { name:"Klemp√≠≈ôsk√© pr√°ce", unitPrice:700, unit:"hod", qtyDefault:0 },
        { name:"Rovn√°n√≠ karoserie", unitPrice:900, unit:"hod", qtyDefault:0 },
        { name:"V√Ωmƒõna d√≠lu karoserie", unitPrice:1500, unit:"ks", qtyDefault:0 }
      ],
      autolakyrnici: [
        { name:"Lakov√°n√≠ d√≠lu", unitPrice:1800, unit:"ks", qtyDefault:0 },
        { name:"P≈ô√≠prava k lakov√°n√≠", unitPrice:600, unit:"hod", qtyDefault:0 },
        { name:"Le≈°tƒõn√≠", unitPrice:500, unit:"hod", qtyDefault:0 }
      ],
      zahradnici: [
        { name:"√ödr≈æba zahrady", unitPrice:400, unit:"hod", qtyDefault:0 },
        { name:"Pokl√°dka tr√°vn√≠ku", unitPrice:120, unit:"m¬≤", qtyDefault:0 },
        { name:"St≈ôih ke≈ô≈Ø", unitPrice:350, unit:"hod", qtyDefault:0 }
      ],
      kovari: [
        { name:"Zak√°zkov√° v√Ωroba", unitPrice:800, unit:"hod", qtyDefault:0 },
        { name:"Mont√°≈æ v√Ωrobk≈Ø", unitPrice:600, unit:"hod", qtyDefault:0 },
        { name:"Povrchov√° √∫prava", unitPrice:550, unit:"hod", qtyDefault:0 }
      ],
      montaznici: [
        { name:"Mont√°≈æ n√°bytku", unitPrice:450, unit:"hod", qtyDefault:0 },
        { name:"Instalace spot≈ôebiƒç≈Ø", unitPrice:700, unit:"ks", qtyDefault:0 },
        { name:"Doprava a manipulace", unitPrice:18, unit:"km", qtyDefault:0 }
      ],
      uklid: [
        { name:"Bƒõ≈æn√Ω √∫klid", unitPrice:250, unit:"hod", qtyDefault:0 },
        { name:"Gener√°ln√≠ √∫klid", unitPrice:350, unit:"hod", qtyDefault:0 },
        { name:"Myt√≠ oken", unitPrice:35, unit:"m¬≤", qtyDefault:0 }
      ],
      ostatni: [
        { name:"Drobn√© pr√°ce", unitPrice:380, unit:"hod", qtyDefault:0 },
        { name:"V√Ωjezd/diagnostika", unitPrice:600, unit:"zak√°zka", qtyDefault:0 },
        { name:"Materi√°l ‚Äì pau≈°√°l", unitPrice:300, unit:"zak√°zka", qtyDefault:0 }
      ]
    };

    // ---- 2) Pomocn√© ----
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
    const params = new URLSearchParams(location.search);
    const PROF = (params.get('p')||'').toLowerCase();
    const fmt = n => (Math.round((n+Number.EPSILON)*100)/100).toFixed(2);
    const isPremium = () => localStorage.getItem('isPremium') === '1';

    // ---- 3) Render m≈ô√≠≈æky (bez parametru) ----
    function renderGrid(){
      $('#pageTitle').textContent = 'Cen√≠k prac√≠ ‚Äì v√Ωbƒõr profese';
      const grid = $('#profeseGrid');
      grid.style.display = '';
      grid.innerHTML = Object.entries(LABELS).map(([key,label]) => `
        <a class="tile" href="cenik.html?p=${key}">
          <div class="tile-ico">üõ†Ô∏è</div>
          <div class="tile-title">${label}</div>
          <div class="tile-desc">Otev≈ô√≠t cen√≠k</div>
        </a>
      `).join('');
    }

    // ---- 4) Render tabulky (s parametrem) ----
    function setPremiumUI(){
      const badge = $('#premiumBadge');
      const saveBtn = $('#savePrices');
      const inputs = $$('input[data-price]');
      if (isPremium()){
        badge.textContent = 'PREMIUM';
        badge.classList.add('success');
        saveBtn.style.display = 'inline-block';
        inputs.forEach(i=>i.removeAttribute('readonly'));
      } else {
        badge.textContent = 'FREE';
        badge.classList.remove('success');
        saveBtn.style.display = 'none';
        inputs.forEach(i=>i.setAttribute('readonly','readonly'));
      }
    }

    function bindCalc(){
      $$('input[data-price], input[data-qty]').forEach(inp=>{
        inp.addEventListener('input', recalc);
        inp.addEventListener('change', recalc);
      });
      $('#savePrices').addEventListener('click', savePrices);
      $('#sendToOffer').addEventListener('click', sendToOffer);
    }

    function recalc(){
      let sum = 0;
      $$('#rows tr').forEach(tr=>{
        const price = parseFloat(tr.querySelector('input[data-price]').value) || 0;
        const qty   = parseFloat(tr.querySelector('input[data-qty]').value) || 0;
        const total = price * qty;
        tr.querySelector('[data-total]').textContent = fmt(total);
        sum += total;
      });
      $('#sum').textContent = fmt(sum);
    }

    function savePrices(){
      if (!isPremium()){ alert('√öprava cen je jen pro Premium.'); return; }
      const rows = $$('#rows tr').map(tr => ({
        name: tr.children[0].textContent,
        unitPrice: parseFloat(tr.querySelector('input[data-price]').value) || 0,
        unit: tr.children[3].textContent,
        qtyDefault: parseFloat(tr.querySelector('input[data-qty]').value) || 0
      }));
      localStorage.setItem(`pricing_${PROF}`, JSON.stringify(rows));
      alert('Ceny ulo≈æeny.');
    }

    function sendToOffer(){
      const items = $$('#rows tr').map(tr => ({
        name: tr.children[0].textContent,
        unitPrice: parseFloat(tr.querySelector('input[data-price]').value) || 0,
        unit: tr.children[3].textContent,
        qty: parseFloat(tr.querySelector('input[data-qty]').value) || 0,
        total: parseFloat(tr.querySelector('[data-total]').textContent.replace(',','.')) || 0
      })).filter(x => x.qty > 0);
      localStorage.setItem('offer_from_pricing', JSON.stringify({
        profession: PROF,
        label: LABELS[PROF] || PROF,
        items
      }));
      location.href = 'novanabidka.html';
    }

    function renderTable(items){
      $('#profeseGrid').style.display = 'none';
      $('#cenikCard').style.display = '';
      $('#pageTitle').textContent = `Cen√≠k ‚Äì ${LABELS[PROF] || 'Profese'}`;
      $('#hlavicka').textContent = `Polo≈æky ‚Äì ${LABELS[PROF] || PROF}`;

      let saved = null;
      try { saved = JSON.parse(localStorage.getItem(`pricing_${PROF}`) || 'null'); } catch(e){}
      const data = (saved && Array.isArray(saved) && saved.length) ? saved : items;

      $('#rows').innerHTML = data.map(it => `
        <tr>
          <td>${it.name}</td>
          <td><input data-price class="price-input" type="number" min="0" step="0.01" value="${it.unitPrice}"></td>
          <td><input data-qty class="qty-input" type="number" min="0" step="0.01" value="${it.qtyDefault || 0}"></td>
          <td>${it.unit || ''}</td>
          <td><span data-total>0.00</span></td>
        </tr>
      `).join('');

      setPremiumUI();
      bindCalc();
      recalc();
    }

    // ---- 5) Start ----
    if (!PROF || !ITEMS[PROF]) {
      renderGrid();
    } else {
      renderTable(ITEMS[PROF]);
    }
  });
  </script>
</body>
</html>
